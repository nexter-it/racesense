{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/racesense/racesense-frontend/src/pages/RaceLive.jsx\",\n  _s = $RefreshSig$();\n// src/pages/RaceLive.jsx\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport '../App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE = process.env.REACT_APP_API_BASE || `http://${window.location.hostname}:5000`;\nconst WS_URL = process.env.REACT_APP_WS_URL || `ws://${window.location.hostname}:5001`;\nfunction toRad(d) {\n  return d * Math.PI / 180;\n}\nfunction haversine(lat1, lon1, lat2, lon2) {\n  const R = 6371000;\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\nconst formatLap = s => {\n  if (!s) return '—';\n  const m = Math.floor(s / 60);\n  const sec = (s % 60).toFixed(3);\n  return `${m}:${sec.padStart(6, '0')}`;\n};\nexport default function RaceLive({\n  raceConfig,\n  onStopRace\n}) {\n  _s();\n  var _snapshot$totalLaps, _snapshot$circuit, _circuitData$stats, _snapshot$circuit2, _snapshot$circuit2$st, _circuitData$stats2, _snapshot$circuit3, _snapshot$circuit3$st, _circuitData$params2, _snapshot$circuit4, _snapshot$circuit4$pa, _circuitData$params3, _snapshot$circuit5, _snapshot$circuit5$pa, _statusColors$lbBorde;\n  const {\n    circuitData,\n    totalLaps\n  } = raceConfig;\n  const [snapshot, setSnapshot] = useState(null);\n  const [blink, setBlink] = useState(true);\n  useEffect(() => {\n    const t = setInterval(() => setBlink(b => !b), 700);\n    return () => clearInterval(t);\n  }, []);\n\n  // trail client-side (solo per grafica)\n  const trailsRef = useRef({});\n  const canvasRef = useRef(null);\n  const animFrameRef = useRef(null);\n  const zoomRef = useRef(1);\n  const panRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const isDraggingRef = useRef(false);\n  const lastMouseRef = useRef({\n    x: 0,\n    y: 0\n  });\n\n  // WebSocket — riceviamo race_snapshot dal server\n  useEffect(() => {\n    const ws = new WebSocket(WS_URL);\n    ws.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        if ((data === null || data === void 0 ? void 0 : data.type) === 'race_snapshot') {\n          // aggiorna trails\n          data.drivers.forEach(d => {\n            const key = d.mac;\n            const trail = trailsRef.current[key] || [];\n            const next = [...trail, {\n              lat: d.lat,\n              lon: d.lon\n            }].slice(-30);\n            trailsRef.current[key] = next;\n          });\n          setSnapshot(data);\n        } else if ((data === null || data === void 0 ? void 0 : data.type) === 'race_inactive') {\n          setSnapshot(null);\n        }\n      } catch {}\n    };\n    ws.onerror = e => console.error('[RaceLive] WS error', e);\n    return () => {\n      try {\n        ws.close();\n      } catch {}\n    };\n  }, []);\n\n  // ---- Canvas rendering (uguale alla tua UI, usa sectors del circuito) ----\n  useEffect(() => {\n    if (!circuitData || !canvasRef.current) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    const dpr = window.devicePixelRatio || 1;\n    const ensureSize = () => {\n      const container = canvas.parentElement;\n      const w = container.clientWidth || 600;\n      const h = container.clientHeight || 520;\n      if (canvas.width !== Math.floor(w * dpr) || canvas.height !== Math.floor(h * dpr)) {\n        canvas.width = Math.floor(w * dpr);\n        canvas.height = Math.floor(h * dpr);\n        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n      }\n    };\n    const onResize = () => ensureSize();\n    ensureSize();\n    window.addEventListener('resize', onResize);\n    const wheel = e => {\n      e.preventDefault();\n      zoomRef.current = Math.max(0.5, Math.min(5, zoomRef.current * (e.deltaY > 0 ? 0.9 : 1.1)));\n    };\n    const mousedown = e => {\n      isDraggingRef.current = true;\n      lastMouseRef.current = {\n        x: e.clientX,\n        y: e.clientY\n      };\n      canvas.style.cursor = 'grabbing';\n    };\n    const mousemove = e => {\n      if (!isDraggingRef.current) return;\n      const dx = e.clientX - lastMouseRef.current.x;\n      const dy = e.clientY - lastMouseRef.current.y;\n      panRef.current.x += dx;\n      panRef.current.y += dy;\n      lastMouseRef.current = {\n        x: e.clientX,\n        y: e.clientY\n      };\n    };\n    const mouseup = () => {\n      isDraggingRef.current = false;\n      canvas.style.cursor = 'grab';\n    };\n    canvas.addEventListener('wheel', wheel, {\n      passive: false\n    });\n    canvas.addEventListener('mousedown', mousedown);\n    canvas.addEventListener('mousemove', mousemove);\n    canvas.addEventListener('mouseup', mouseup);\n    canvas.addEventListener('mouseleave', mouseup);\n    canvas.style.cursor = 'grab';\n\n    // precompute projection params\n    const lats = circuitData.sectors.map(s => s.lat);\n    const lons = circuitData.sectors.map(s => s.lon);\n    const minLat = Math.min(...lats),\n      maxLat = Math.max(...lats);\n    const minLon = Math.min(...lons),\n      maxLon = Math.max(...lons);\n    const centerLat = (minLat + maxLat) / 2;\n    const centerLon = (minLon + maxLon) / 2;\n    const R = 6371000;\n    const centerLatRad = centerLat * Math.PI / 180;\n    const dxList = lons.map(l => (l - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad));\n    const dyList = lats.map(l => (l - centerLat) * Math.PI / 180 * R);\n    const maxDx = Math.max(...dxList.map(Math.abs));\n    const maxDy = Math.max(...dyList.map(Math.abs));\n    const padding = 40;\n    const project = (lat, lon) => {\n      const w = canvas.width / dpr;\n      const h = canvas.height / dpr;\n      const maxRange = Math.max(maxDx, maxDy) * 1.1;\n      const scale = Math.min(w - padding * 2, h - padding * 2) / (maxRange * 2) * zoomRef.current;\n      const dx = (lon - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad);\n      const dy = (lat - centerLat) * Math.PI / 180 * R;\n      const x = w / 2 + dx * scale + panRef.current.x;\n      const y = h / 2 - dy * scale + panRef.current.y;\n      return {\n        x,\n        y,\n        scale\n      };\n    };\n    const draw = () => {\n      var _circuitData$params$w, _circuitData$params, _pts$;\n      ensureSize();\n      const w = canvas.width / dpr;\n      const h = canvas.height / dpr;\n      ctx.clearRect(0, 0, w, h);\n      ctx.fillStyle = '#0a0a0a';\n      ctx.fillRect(0, 0, w, h);\n      const widthMeters = (_circuitData$params$w = (_circuitData$params = circuitData.params) === null || _circuitData$params === void 0 ? void 0 : _circuitData$params.widthMeters) !== null && _circuitData$params$w !== void 0 ? _circuitData$params$w : 6;\n      const pts = circuitData.sectors.map(s => project(s.lat, s.lon));\n      const scale = ((_pts$ = pts[0]) === null || _pts$ === void 0 ? void 0 : _pts$.scale) || 1;\n      const trackPx = Math.max(6, widthMeters * scale);\n\n      // bordo soft\n      ctx.strokeStyle = 'rgba(255,255,255,0.10)';\n      ctx.lineWidth = trackPx + 4;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n      ctx.beginPath();\n      pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n      ctx.closePath();\n      ctx.stroke();\n      // asfalto\n      ctx.strokeStyle = 'rgba(80, 84, 90, 0.95)';\n      ctx.lineWidth = trackPx;\n      ctx.beginPath();\n      pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n      ctx.closePath();\n      ctx.stroke();\n      // start\n      if (pts.length > 1) {\n        const s0 = pts[0],\n          s1 = pts[1];\n        const ang = Math.atan2(s1.y - s0.y, s1.x - s0.x);\n        ctx.save();\n        ctx.translate(s0.x, s0.y);\n        ctx.rotate(ang);\n        ctx.strokeStyle = '#ffffff';\n        ctx.lineWidth = Math.max(2, trackPx * 0.12);\n        ctx.beginPath();\n        ctx.moveTo(0, -trackPx * 0.5);\n        ctx.lineTo(0, trackPx * 0.5);\n        ctx.stroke();\n        ctx.restore();\n      }\n\n      // piloti (dalla snapshot)\n      const drivers = (snapshot === null || snapshot === void 0 ? void 0 : snapshot.drivers) || [];\n      const sorted = [...drivers].sort((a, b) => a.position - b.position); // già ordinati, ma per sicurezza\n\n      sorted.forEach((d, i) => {\n        const p = project(d.lat, d.lon);\n        const trail = trailsRef.current[d.mac] || [];\n        if (trail.length > 1) {\n          ctx.strokeStyle = '#C0FF03';\n          ctx.globalAlpha = 0.6;\n          ctx.lineWidth = Math.max(2, trackPx * 0.12);\n          ctx.beginPath();\n          trail.forEach((t, ti) => {\n            const tp = project(t.lat, t.lon);\n            ti ? ctx.lineTo(tp.x, tp.y) : ctx.moveTo(tp.x, tp.y);\n          });\n          ctx.stroke();\n          ctx.globalAlpha = 1;\n        }\n        const isLeader = i === 0;\n        const r = Math.max(5, trackPx * 0.18) + (isLeader ? 1 : 0);\n        ctx.shadowColor = 'rgba(0,0,0,0.5)';\n        ctx.shadowBlur = 4;\n        ctx.fillStyle = '#C0FF03';\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, r, 0, Math.PI * 2);\n        ctx.fill();\n        ctx.shadowBlur = 0;\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n        ctx.fillStyle = '#fff';\n        ctx.font = 'bold 10px Roboto, sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText(d.tag, p.x, p.y - (r + 8));\n      });\n      animFrameRef.current = requestAnimationFrame(draw);\n    };\n    draw();\n    return () => {\n      window.removeEventListener('resize', onResize);\n      canvas.removeEventListener('wheel', wheel);\n      canvas.removeEventListener('mousedown', mousedown);\n      canvas.removeEventListener('mousemove', mousemove);\n      canvas.removeEventListener('mouseup', mouseup);\n      canvas.removeEventListener('mouseleave', mouseup);\n      if (animFrameRef.current) cancelAnimationFrame(animFrameRef.current);\n    };\n  }, [circuitData, snapshot]);\n  const leaderboard = useMemo(() => {\n    if (!(snapshot !== null && snapshot !== void 0 && snapshot.drivers)) return [];\n    return [...snapshot.drivers].sort((a, b) => a.position - b.position);\n  }, [snapshot]);\n  const globalBestLap = (snapshot === null || snapshot === void 0 ? void 0 : snapshot.globalBestLap) || null;\n  const statusColors = useMemo(() => ({\n    chipBg: 'rgba(21,193,48,.15)',\n    chipBorder: '#15c130',\n    chipText: '#e9ffe0',\n    lbBorder: null\n  }), []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"main small-top\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rs-live-topbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rs-live-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            \"aria-hidden\": true,\n            style: {\n              width: 10,\n              height: 10,\n              borderRadius: '50%',\n              background: '#ff4d4f',\n              boxShadow: '0 0 12px rgba(255,77,79,.8)',\n              opacity: blink ? 1 : .25,\n              transition: 'opacity .15s linear'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 13\n          }, this), \"LIVE\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [(_snapshot$totalLaps = snapshot === null || snapshot === void 0 ? void 0 : snapshot.totalLaps) !== null && _snapshot$totalLaps !== void 0 ? _snapshot$totalLaps : totalLaps, \" giri\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          style: {\n            background: statusColors.chipBg,\n            border: `1px solid ${statusColors.chipBorder}`,\n            color: statusColors.chipText,\n            fontWeight: 800\n          },\n          children: \"IN CORSO\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rs-live-right\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: (circuitData === null || circuitData === void 0 ? void 0 : circuitData.name) || (snapshot === null || snapshot === void 0 ? void 0 : (_snapshot$circuit = snapshot.circuit) === null || _snapshot$circuit === void 0 ? void 0 : _snapshot$circuit.name) || 'Circuito'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }, this), ((circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$stats = circuitData.stats) === null || _circuitData$stats === void 0 ? void 0 : _circuitData$stats.lengthMeters) || (snapshot === null || snapshot === void 0 ? void 0 : (_snapshot$circuit2 = snapshot.circuit) === null || _snapshot$circuit2 === void 0 ? void 0 : (_snapshot$circuit2$st = _snapshot$circuit2.stats) === null || _snapshot$circuit2$st === void 0 ? void 0 : _snapshot$circuit2$st.lengthMeters)) && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [((circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$stats2 = circuitData.stats) === null || _circuitData$stats2 === void 0 ? void 0 : _circuitData$stats2.lengthMeters) || (snapshot === null || snapshot === void 0 ? void 0 : (_snapshot$circuit3 = snapshot.circuit) === null || _snapshot$circuit3 === void 0 ? void 0 : (_snapshot$circuit3$st = _snapshot$circuit3.stats) === null || _snapshot$circuit3$st === void 0 ? void 0 : _snapshot$circuit3$st.lengthMeters)).toFixed(0), \" m\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }, this), ((circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$params2 = circuitData.params) === null || _circuitData$params2 === void 0 ? void 0 : _circuitData$params2.widthMeters) || (snapshot === null || snapshot === void 0 ? void 0 : (_snapshot$circuit4 = snapshot.circuit) === null || _snapshot$circuit4 === void 0 ? void 0 : (_snapshot$circuit4$pa = _snapshot$circuit4.params) === null || _snapshot$circuit4$pa === void 0 ? void 0 : _snapshot$circuit4$pa.widthMeters)) && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [(circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$params3 = circuitData.params) === null || _circuitData$params3 === void 0 ? void 0 : _circuitData$params3.widthMeters) || (snapshot === null || snapshot === void 0 ? void 0 : (_snapshot$circuit5 = snapshot.circuit) === null || _snapshot$circuit5 === void 0 ? void 0 : (_snapshot$circuit5$pa = _snapshot$circuit5.params) === null || _snapshot$circuit5$pa === void 0 ? void 0 : _snapshot$circuit5$pa.widthMeters), \" m larghezza\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rs-live-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-card\",\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          className: \"track-canvas\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"leaderboard-card\",\n        style: {\n          borderColor: (_statusColors$lbBorde = statusColors.lbBorder) !== null && _statusColors$lbBorde !== void 0 ? _statusColors$lbBorde : 'var(--line)',\n          boxShadow: statusColors.lbBorder ? `0 8px 32px ${statusColors.lbBorder}33, inset 0 0 0 1px ${statusColors.lbBorder}55` : undefined\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-title\",\n            children: \"CLASSIFICA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-sub\",\n            children: [leaderboard.length, \" piloti\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-list\",\n          children: leaderboard.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"no-drivers\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Nessun dato GPS ancora disponibile\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"muted\",\n              children: \"Appena arrivano i pacchetti la classifica si popola\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 15\n          }, this) : leaderboard.map((d, idx) => {\n            var _snapshot$totalLaps2;\n            const isLeader = idx === 0;\n            const fastest = d.bestLapTime && globalBestLap && d.bestLapTime === globalBestLap;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `lb-row ${isLeader ? 'lb-leader' : ''}`,\n              title: d.fullName,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-pos\",\n                children: idx + 1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-team\",\n                children: d.photoTeamUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: `${API_BASE}${d.photoTeamUrl}`,\n                  alt: d.team,\n                  className: \"lb-team-logo\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 276,\n                  columnNumber: 25\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"lb-team-color\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 277,\n                  columnNumber: 28\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 274,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-name\",\n                children: d.tag\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-gap\",\n                children: d.gapToLeader || (isLeader ? 'LEADER' : '')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 280,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-icons\",\n                children: fastest && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"lb-icon purple\",\n                  title: `Best lap ${formatLap(d.bestLapTime)}`,\n                  children: \"\\u23F1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 35\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-lap\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"muted\",\n                  children: \"Lap\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 284,\n                  columnNumber: 45\n                }, this), \"\\xA0\", d.lapCount, \"/\", (_snapshot$totalLaps2 = snapshot === null || snapshot === void 0 ? void 0 : snapshot.totalLaps) !== null && _snapshot$totalLaps2 !== void 0 ? _snapshot$totalLaps2 : totalLaps]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 284,\n                columnNumber: 21\n              }, this)]\n            }, d.mac, true, {\n              fileName: _jsxFileName,\n              lineNumber: 272,\n              columnNumber: 19\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"leaderboard-card\",\n      style: {\n        marginTop: 12,\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-header\",\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'baseline'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-title\",\n          children: \"CLASSIFICA DETTAGLIATA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-sub\",\n          children: [leaderboard.length, \" piloti \\u2022 tempi ultimo giro e miglior giro\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-list\",\n        children: leaderboard.map((d, idx) => {\n          var _snapshot$totalLaps3;\n          const fastest = d.bestLapTime && globalBestLap && d.bestLapTime === globalBestLap;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-row\",\n            style: {\n              gridTemplateColumns: '28px 28px 1fr 90px 110px 110px 140px 90px'\n            },\n            title: d.fullName,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-pos\",\n              children: idx + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-team\",\n              children: d.photoTeamUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n                src: `${API_BASE}${d.photoTeamUrl}`,\n                alt: d.team,\n                className: \"lb-team-logo\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 312,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-team-color\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 313,\n                columnNumber: 24\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-name\",\n              children: d.tag\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              style: {\n                textAlign: 'right'\n              },\n              children: idx === 0 ? 'LEADER' : d.gapToLeader\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 316,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Ultimo giro\",\n              style: {\n                fontWeight: 700,\n                color: '#e9ffe0'\n              },\n              children: formatLap(d.lastLapTime)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Miglior giro\",\n              style: {\n                fontWeight: 700,\n                color: fastest ? '#b085ff' : '#e9ffe0'\n              },\n              children: [formatLap(d.bestLapTime), fastest && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"lb-icon purple\",\n                style: {\n                  marginLeft: 6\n                },\n                children: \"\\u23F1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 57\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Penalit\\xE0 assegnate\",\n              style: {\n                fontWeight: 800\n              },\n              children: \"\\u2014\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-lap\",\n              style: {\n                textAlign: 'right'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"muted\",\n                children: \"Lap\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 19\n              }, this), \"\\xA0\", d.lapCount, \"/\", (_snapshot$totalLaps3 = snapshot === null || snapshot === void 0 ? void 0 : snapshot.totalLaps) !== null && _snapshot$totalLaps3 !== void 0 ? _snapshot$totalLaps3 : totalLaps]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 17\n            }, this)]\n          }, `wide-${d.mac}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"leaderboard-card\",\n      style: {\n        marginTop: 12,\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-header\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-title\",\n          children: \"COMANDI GARA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 36\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"race-controls\",\n        style: {\n          justifyContent: 'space-between',\n          gap: 12,\n          flexWrap: 'wrap',\n          padding: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"muted\",\n          children: \"Stato gestito lato server in questa versione\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            marginTop: '20px'\n          },\n          className: \"btn-danger\",\n          onClick: async () => {\n            try {\n              await fetch(`${API_BASE}/api/race/stop`, {\n                method: 'POST'\n              });\n            } catch {}\n            onStopRace();\n          },\n          children: \"Termina gara\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 219,\n    columnNumber: 5\n  }, this);\n}\n_s(RaceLive, \"WOg9NKVL4h8Lpn49KiI7sVT7Wxg=\");\n_c = RaceLive;\nvar _c;\n$RefreshReg$(_c, \"RaceLive\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","jsxDEV","_jsxDEV","API_BASE","process","env","REACT_APP_API_BASE","window","location","hostname","WS_URL","REACT_APP_WS_URL","toRad","d","Math","PI","haversine","lat1","lon1","lat2","lon2","R","dLat","dLon","a","sin","cos","atan2","sqrt","formatLap","s","m","floor","sec","toFixed","padStart","RaceLive","raceConfig","onStopRace","_s","_snapshot$totalLaps","_snapshot$circuit","_circuitData$stats","_snapshot$circuit2","_snapshot$circuit2$st","_circuitData$stats2","_snapshot$circuit3","_snapshot$circuit3$st","_circuitData$params2","_snapshot$circuit4","_snapshot$circuit4$pa","_circuitData$params3","_snapshot$circuit5","_snapshot$circuit5$pa","_statusColors$lbBorde","circuitData","totalLaps","snapshot","setSnapshot","blink","setBlink","t","setInterval","b","clearInterval","trailsRef","canvasRef","animFrameRef","zoomRef","panRef","x","y","isDraggingRef","lastMouseRef","ws","WebSocket","onmessage","event","data","JSON","parse","type","drivers","forEach","key","mac","trail","current","next","lat","lon","slice","onerror","e","console","error","close","canvas","ctx","getContext","dpr","devicePixelRatio","ensureSize","container","parentElement","w","clientWidth","h","clientHeight","width","height","setTransform","onResize","addEventListener","wheel","preventDefault","max","min","deltaY","mousedown","clientX","clientY","style","cursor","mousemove","dx","dy","mouseup","passive","lats","sectors","map","lons","minLat","maxLat","minLon","maxLon","centerLat","centerLon","centerLatRad","dxList","l","dyList","maxDx","abs","maxDy","padding","project","maxRange","scale","draw","_circuitData$params$w","_circuitData$params","_pts$","clearRect","fillStyle","fillRect","widthMeters","params","pts","trackPx","strokeStyle","lineWidth","lineCap","lineJoin","beginPath","p","i","lineTo","moveTo","closePath","stroke","length","s0","s1","ang","save","translate","rotate","restore","sorted","sort","position","globalAlpha","ti","tp","isLeader","r","shadowColor","shadowBlur","arc","fill","font","textAlign","fillText","tag","requestAnimationFrame","removeEventListener","cancelAnimationFrame","leaderboard","globalBestLap","statusColors","chipBg","chipBorder","chipText","lbBorder","className","children","display","alignItems","gap","borderRadius","background","boxShadow","opacity","transition","fileName","_jsxFileName","lineNumber","columnNumber","border","color","fontWeight","name","circuit","stats","lengthMeters","ref","borderColor","undefined","idx","_snapshot$totalLaps2","fastest","bestLapTime","title","fullName","photoTeamUrl","src","alt","team","gapToLeader","lapCount","marginTop","justifyContent","_snapshot$totalLaps3","gridTemplateColumns","lastLapTime","marginLeft","flexWrap","onClick","fetch","method","_c","$RefreshReg$"],"sources":["/home/ubuntu/racesense/racesense-frontend/src/pages/RaceLive.jsx"],"sourcesContent":["// src/pages/RaceLive.jsx\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport '../App.css';\n\nconst API_BASE = process.env.REACT_APP_API_BASE || `http://${window.location.hostname}:5000`;\nconst WS_URL = process.env.REACT_APP_WS_URL || `ws://${window.location.hostname}:5001`;\n\nfunction toRad(d) { return d * Math.PI / 180; }\nfunction haversine(lat1, lon1, lat2, lon2) {\n  const R = 6371000;\n  const dLat = toRad(lat2 - lat1);\n  const dLon = toRad(lon2 - lon1);\n  const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) ** 2;\n  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n}\nconst formatLap = (s) => {\n  if (!s) return '—';\n  const m = Math.floor(s / 60);\n  const sec = (s % 60).toFixed(3);\n  return `${m}:${sec.padStart(6, '0')}`;\n};\n\nexport default function RaceLive({ raceConfig, onStopRace }) {\n  const { circuitData, totalLaps } = raceConfig;\n\n  const [snapshot, setSnapshot] = useState(null);\n  const [blink, setBlink] = useState(true);\n  useEffect(() => { const t = setInterval(() => setBlink(b => !b), 700); return () => clearInterval(t); }, []);\n\n  // trail client-side (solo per grafica)\n  const trailsRef = useRef({});\n  const canvasRef = useRef(null);\n  const animFrameRef = useRef(null);\n  const zoomRef = useRef(1);\n  const panRef = useRef({ x: 0, y: 0 });\n  const isDraggingRef = useRef(false);\n  const lastMouseRef = useRef({ x: 0, y: 0 });\n\n  // WebSocket — riceviamo race_snapshot dal server\n  useEffect(() => {\n    const ws = new WebSocket(WS_URL);\n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        if (data?.type === 'race_snapshot') {\n          // aggiorna trails\n          data.drivers.forEach(d => {\n            const key = d.mac;\n            const trail = trailsRef.current[key] || [];\n            const next = [...trail, { lat: d.lat, lon: d.lon }].slice(-30);\n            trailsRef.current[key] = next;\n          });\n          setSnapshot(data);\n        } else if (data?.type === 'race_inactive') {\n          setSnapshot(null);\n        }\n      } catch { }\n    };\n    ws.onerror = (e) => console.error('[RaceLive] WS error', e);\n    return () => { try { ws.close(); } catch { } };\n  }, []);\n\n  // ---- Canvas rendering (uguale alla tua UI, usa sectors del circuito) ----\n  useEffect(() => {\n    if (!circuitData || !canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    const dpr = window.devicePixelRatio || 1;\n\n    const ensureSize = () => {\n      const container = canvas.parentElement;\n      const w = container.clientWidth || 600;\n      const h = container.clientHeight || 520;\n      if (canvas.width !== Math.floor(w * dpr) || canvas.height !== Math.floor(h * dpr)) {\n        canvas.width = Math.floor(w * dpr);\n        canvas.height = Math.floor(h * dpr);\n        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n      }\n    };\n    const onResize = () => ensureSize();\n    ensureSize();\n    window.addEventListener('resize', onResize);\n\n    const wheel = (e) => { e.preventDefault(); zoomRef.current = Math.max(0.5, Math.min(5, zoomRef.current * (e.deltaY > 0 ? 0.9 : 1.1))); };\n    const mousedown = (e) => { isDraggingRef.current = true; lastMouseRef.current = { x: e.clientX, y: e.clientY }; canvas.style.cursor = 'grabbing'; };\n    const mousemove = (e) => {\n      if (!isDraggingRef.current) return;\n      const dx = e.clientX - lastMouseRef.current.x;\n      const dy = e.clientY - lastMouseRef.current.y;\n      panRef.current.x += dx; panRef.current.y += dy;\n      lastMouseRef.current = { x: e.clientX, y: e.clientY };\n    };\n    const mouseup = () => { isDraggingRef.current = false; canvas.style.cursor = 'grab'; };\n\n    canvas.addEventListener('wheel', wheel, { passive: false });\n    canvas.addEventListener('mousedown', mousedown);\n    canvas.addEventListener('mousemove', mousemove);\n    canvas.addEventListener('mouseup', mouseup);\n    canvas.addEventListener('mouseleave', mouseup);\n    canvas.style.cursor = 'grab';\n\n    // precompute projection params\n    const lats = circuitData.sectors.map(s => s.lat);\n    const lons = circuitData.sectors.map(s => s.lon);\n    const minLat = Math.min(...lats), maxLat = Math.max(...lats);\n    const minLon = Math.min(...lons), maxLon = Math.max(...lons);\n    const centerLat = (minLat + maxLat) / 2;\n    const centerLon = (minLon + maxLon) / 2;\n    const R = 6371000;\n    const centerLatRad = centerLat * Math.PI / 180;\n    const dxList = lons.map(l => (l - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad));\n    const dyList = lats.map(l => (l - centerLat) * Math.PI / 180 * R);\n    const maxDx = Math.max(...dxList.map(Math.abs));\n    const maxDy = Math.max(...dyList.map(Math.abs));\n    const padding = 40;\n\n    const project = (lat, lon) => {\n      const w = canvas.width / dpr;\n      const h = canvas.height / dpr;\n      const maxRange = Math.max(maxDx, maxDy) * 1.1;\n      const scale = Math.min(w - padding * 2, h - padding * 2) / (maxRange * 2) * zoomRef.current;\n      const dx = (lon - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad);\n      const dy = (lat - centerLat) * Math.PI / 180 * R;\n      const x = w / 2 + dx * scale + panRef.current.x;\n      const y = h / 2 - dy * scale + panRef.current.y;\n      return { x, y, scale };\n    };\n\n    const draw = () => {\n      ensureSize();\n      const w = canvas.width / dpr;\n      const h = canvas.height / dpr;\n      ctx.clearRect(0, 0, w, h);\n      ctx.fillStyle = '#0a0a0a';\n      ctx.fillRect(0, 0, w, h);\n\n      const widthMeters = circuitData.params?.widthMeters ?? 6;\n      const pts = circuitData.sectors.map(s => project(s.lat, s.lon));\n      const scale = pts[0]?.scale || 1;\n      const trackPx = Math.max(6, widthMeters * scale);\n\n      // bordo soft\n      ctx.strokeStyle = 'rgba(255,255,255,0.10)';\n      ctx.lineWidth = trackPx + 4;\n      ctx.lineCap = 'round';\n      ctx.lineJoin = 'round';\n      ctx.beginPath(); pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y)); ctx.closePath(); ctx.stroke();\n      // asfalto\n      ctx.strokeStyle = 'rgba(80, 84, 90, 0.95)';\n      ctx.lineWidth = trackPx;\n      ctx.beginPath(); pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y)); ctx.closePath(); ctx.stroke();\n      // start\n      if (pts.length > 1) {\n        const s0 = pts[0], s1 = pts[1];\n        const ang = Math.atan2(s1.y - s0.y, s1.x - s0.x);\n        ctx.save(); ctx.translate(s0.x, s0.y); ctx.rotate(ang);\n        ctx.strokeStyle = '#ffffff'; ctx.lineWidth = Math.max(2, trackPx * 0.12);\n        ctx.beginPath(); ctx.moveTo(0, -trackPx * 0.5); ctx.lineTo(0, trackPx * 0.5); ctx.stroke();\n        ctx.restore();\n      }\n\n      // piloti (dalla snapshot)\n      const drivers = snapshot?.drivers || [];\n      const sorted = [...drivers].sort((a, b) => a.position - b.position); // già ordinati, ma per sicurezza\n\n      sorted.forEach((d, i) => {\n        const p = project(d.lat, d.lon);\n\n        const trail = trailsRef.current[d.mac] || [];\n        if (trail.length > 1) {\n          ctx.strokeStyle = '#C0FF03';\n          ctx.globalAlpha = 0.6;\n          ctx.lineWidth = Math.max(2, trackPx * 0.12);\n          ctx.beginPath();\n          trail.forEach((t, ti) => {\n            const tp = project(t.lat, t.lon);\n            ti ? ctx.lineTo(tp.x, tp.y) : ctx.moveTo(tp.x, tp.y);\n          });\n          ctx.stroke(); ctx.globalAlpha = 1;\n        }\n\n        const isLeader = i === 0;\n        const r = Math.max(5, trackPx * 0.18) + (isLeader ? 1 : 0);\n        ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 4;\n        ctx.fillStyle = '#C0FF03'; ctx.beginPath(); ctx.arc(p.x, p.y, r, 0, Math.PI * 2); ctx.fill();\n        ctx.shadowBlur = 0; ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();\n\n        ctx.fillStyle = '#fff'; ctx.font = 'bold 10px Roboto, sans-serif'; ctx.textAlign = 'center';\n        ctx.fillText(d.tag, p.x, p.y - (r + 8));\n      });\n\n      animFrameRef.current = requestAnimationFrame(draw);\n    };\n    draw();\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n      canvas.removeEventListener('wheel', wheel);\n      canvas.removeEventListener('mousedown', mousedown);\n      canvas.removeEventListener('mousemove', mousemove);\n      canvas.removeEventListener('mouseup', mouseup);\n      canvas.removeEventListener('mouseleave', mouseup);\n      if (animFrameRef.current) cancelAnimationFrame(animFrameRef.current);\n    };\n  }, [circuitData, snapshot]);\n\n  const leaderboard = useMemo(() => {\n    if (!snapshot?.drivers) return [];\n    return [...snapshot.drivers].sort((a, b) => a.position - b.position);\n  }, [snapshot]);\n\n  const globalBestLap = snapshot?.globalBestLap || null;\n  const statusColors = useMemo(() => ({\n    chipBg: 'rgba(21,193,48,.15)', chipBorder: '#15c130', chipText: '#e9ffe0', lbBorder: null\n  }), []);\n\n  return (\n    <div className=\"main small-top\">\n      <div className=\"rs-live-topbar\">\n        <div className=\"rs-live-left\">\n          <span className=\"chip readonly\" style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n            <span aria-hidden style={{\n              width: 10, height: 10, borderRadius: '50%',\n              background: '#ff4d4f', boxShadow: '0 0 12px rgba(255,77,79,.8)',\n              opacity: blink ? 1 : .25, transition: 'opacity .15s linear'\n            }} />\n            LIVE\n          </span>\n          <span className=\"chip readonly\">{snapshot?.totalLaps ?? totalLaps} giri</span>\n          <span className=\"chip readonly\" style={{\n            background: statusColors.chipBg, border: `1px solid ${statusColors.chipBorder}`,\n            color: statusColors.chipText, fontWeight: 800\n          }}>\n            IN CORSO\n          </span>\n        </div>\n        <div className=\"rs-live-right\">\n          <span className=\"chip readonly\">{circuitData?.name || snapshot?.circuit?.name || 'Circuito'}</span>\n          {(circuitData?.stats?.lengthMeters || snapshot?.circuit?.stats?.lengthMeters) &&\n            <span className=\"chip readonly\">{(circuitData?.stats?.lengthMeters || snapshot?.circuit?.stats?.lengthMeters).toFixed(0)} m</span>}\n          {(circuitData?.params?.widthMeters || snapshot?.circuit?.params?.widthMeters) &&\n            <span className=\"chip readonly\">{(circuitData?.params?.widthMeters || snapshot?.circuit?.params?.widthMeters)} m larghezza</span>}\n        </div>\n      </div>\n\n      <div className=\"rs-live-grid\">\n        <div className=\"track-card\">\n          <canvas ref={canvasRef} className=\"track-canvas\" />\n        </div>\n\n        <div className=\"leaderboard-card\" style={{\n          borderColor: statusColors.lbBorder ?? 'var(--line)',\n          boxShadow: statusColors.lbBorder ? `0 8px 32px ${statusColors.lbBorder}33, inset 0 0 0 1px ${statusColors.lbBorder}55` : undefined\n        }}>\n          <div className=\"lb-header\">\n            <div className=\"lb-title\">CLASSIFICA</div>\n            <div className=\"lb-sub\">{leaderboard.length} piloti</div>\n          </div>\n\n          <div className=\"lb-list\">\n            {leaderboard.length === 0 ? (\n              <div className=\"no-drivers\">\n                <p>Nessun dato GPS ancora disponibile…</p>\n                <small className=\"muted\">Appena arrivano i pacchetti la classifica si popola</small>\n              </div>\n            ) : (\n              leaderboard.map((d, idx) => {\n                const isLeader = idx === 0;\n                const fastest = d.bestLapTime && globalBestLap && d.bestLapTime === globalBestLap;\n                return (\n                  <div key={d.mac} className={`lb-row ${isLeader ? 'lb-leader' : ''}`} title={d.fullName}>\n                    <div className=\"lb-pos\">{idx + 1}</div>\n                    <div className=\"lb-team\">\n                      {d.photoTeamUrl ? (\n                        <img src={`${API_BASE}${d.photoTeamUrl}`} alt={d.team} className=\"lb-team-logo\" />\n                      ) : (<div className=\"lb-team-color\" />)}\n                    </div>\n                    <div className=\"lb-name\">{d.tag}</div>\n                    <div className=\"lb-gap\">{d.gapToLeader || (isLeader ? 'LEADER' : '')}</div>\n                    <div className=\"lb-icons\">\n                      {fastest && <span className=\"lb-icon purple\" title={`Best lap ${formatLap(d.bestLapTime)}`}>⏱</span>}\n                    </div>\n                    <div className=\"lb-lap\"><span className=\"muted\">Lap</span>&nbsp;{d.lapCount}/{snapshot?.totalLaps ?? totalLaps}</div>\n                  </div>\n                );\n              })\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"leaderboard-card\" style={{ marginTop: 12, width: '100%' }}>\n        <div className=\"lb-header\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'baseline' }}>\n          <div className=\"lb-title\">CLASSIFICA DETTAGLIATA</div>\n          <div className=\"lb-sub\">{leaderboard.length} piloti • tempi ultimo giro e miglior giro</div>\n        </div>\n\n        <div className=\"lb-list\">\n          {leaderboard.map((d, idx) => {\n            const fastest = d.bestLapTime && globalBestLap && d.bestLapTime === globalBestLap;\n            return (\n              <div\n                key={`wide-${d.mac}`}\n                className=\"lb-row\"\n                style={{ gridTemplateColumns: '28px 28px 1fr 90px 110px 110px 140px 90px' }}\n                title={d.fullName}\n              >\n                <div className=\"lb-pos\">{idx + 1}</div>\n                <div className=\"lb-team\">\n                  {d.photoTeamUrl ? (\n                    <img src={`${API_BASE}${d.photoTeamUrl}`} alt={d.team} className=\"lb-team-logo\" />\n                  ) : (<div className=\"lb-team-color\" />)}\n                </div>\n                <div className=\"lb-name\">{d.tag}</div>\n                <div className=\"lb-gap\" style={{ textAlign: 'right' }}>{idx === 0 ? 'LEADER' : d.gapToLeader}</div>\n                <div className=\"lb-gap\" title=\"Ultimo giro\" style={{ fontWeight: 700, color: '#e9ffe0' }}>\n                  {formatLap(d.lastLapTime)}\n                </div>\n                <div className=\"lb-gap\" title=\"Miglior giro\" style={{ fontWeight: 700, color: fastest ? '#b085ff' : '#e9ffe0' }}>\n                  {formatLap(d.bestLapTime)}{fastest && <span className=\"lb-icon purple\" style={{ marginLeft: 6 }}>⏱</span>}\n                </div>\n                <div className=\"lb-gap\" title=\"Penalità assegnate\" style={{ fontWeight: 800 }}>\n                  {/* Se in futuro sposti le penalità lato server, mostra qui d.penaltySummary */}\n                  —\n                </div>\n                <div className=\"lb-lap\" style={{ textAlign: 'right' }}>\n                  <span className=\"muted\">Lap</span>&nbsp;{d.lapCount}/{snapshot?.totalLaps ?? totalLaps}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      <div className=\"leaderboard-card\" style={{ marginTop: 12, width: '100%' }}>\n        <div className=\"lb-header\"><div className=\"lb-title\">COMANDI GARA</div></div>\n        <div className=\"race-controls\" style={{ justifyContent: 'space-between', gap: 12, flexWrap: 'wrap', padding: '20px' }}>\n          <div className=\"muted\">Stato gestito lato server in questa versione</div>\n          <button style={{ marginTop: '20px' }} className=\"btn-danger\" onClick={async () => {\n            try {\n              await fetch(`${API_BASE}/api/race/stop`, { method: 'POST' });\n            } catch { }\n            onStopRace();\n          }}>Termina gara</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}