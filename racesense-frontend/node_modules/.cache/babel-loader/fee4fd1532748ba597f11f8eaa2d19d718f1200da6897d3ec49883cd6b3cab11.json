{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/racesense/racesense-frontend/src/pages/RaceLive.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\nimport '../App.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE = process.env.REACT_APP_API_BASE || `http://${window.location.hostname}:5000`;\nconst WS_URL = process.env.REACT_APP_WS_URL || `ws://${window.location.hostname}:5001`;\n\n/* ---------------- Utils ---------------- */\nconst formatLap = s => {\n  if (!s && s !== 0) return '—';\n  const m = Math.floor(s / 60);\n  const sec = (s % 60).toFixed(3);\n  return `${m}:${sec.padStart(6, '0')}`;\n};\n\n/* ---------------- Component ---------------- */\nexport default function RaceLive({\n  raceConfig,\n  onStopRace\n}) {\n  _s();\n  var _summary$totalLaps, _circuitData$stats, _circuitData$params2, _statusColors$lbBorde;\n  const {\n    circuitData,\n    totalLaps\n  } = raceConfig;\n\n  // Stato proveniente dal server\n  const [summary, setSummary] = useState(null); // contiene leaderboard, bestLapOverall, status, ecc\n  const [raceStatus, setRaceStatus] = useState('IN CORSO');\n\n  // UI: blink puntino LIVE\n  const [blink, setBlink] = useState(true);\n  useEffect(() => {\n    const t = setInterval(() => setBlink(b => !b), 700);\n    return () => clearInterval(t);\n  }, []);\n\n  // Canvas & proiezione\n  const canvasRef = useRef(null);\n  const animFrameRef = useRef(null);\n  const zoomRef = useRef(1);\n  const panRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const isDraggingRef = useRef(false);\n  const lastMouseRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const dprRef = useRef(1);\n  // Posizioni piloti aggiornate in tempo reale dai pacchetti GPS\n  const driverPositionsRef = useRef({}); // { [mac]: {lat,lon,tag,color,photoTeamUrl} }\n\n  // ===== WebSocket: ricevo GPS (realtime) + SUMMARY (1Hz dal server) =====\n  useEffect(() => {\n    const ws = new WebSocket(WS_URL);\n    ws.onmessage = event => {\n      try {\n        const msg = JSON.parse(event.data);\n\n        // Aggiornamenti periodici della classifica/calcoli lato server\n        if ((msg === null || msg === void 0 ? void 0 : msg.type) === 'race') {\n          var _msg$payload;\n          setSummary(msg.payload || null);\n          if ((_msg$payload = msg.payload) !== null && _msg$payload !== void 0 && _msg$payload.status) setRaceStatus(msg.payload.status);\n          return;\n        }\n\n        // Pacchetti GPS (realtime). Compatibilità anche con payload \"piatto\" { mac, lat, lon, ... }\n        if ((msg === null || msg === void 0 ? void 0 : msg.type) === 'gps' || msg !== null && msg !== void 0 && msg.mac && msg !== null && msg !== void 0 && msg.lat && msg !== null && msg !== void 0 && msg.lon) {\n          const mac = String(msg.mac);\n          // prendo colore/tag dal summary corrente, se presente\n          const lb = (summary === null || summary === void 0 ? void 0 : summary.leaderboard) || [];\n          const row = lb.find(x => x.mac === mac);\n          driverPositionsRef.current[mac] = {\n            lat: Number(msg.lat),\n            lon: Number(msg.lon),\n            tag: ((row === null || row === void 0 ? void 0 : row.tag) || 'PIL').slice(0, 4),\n            color: (row === null || row === void 0 ? void 0 : row.color) || '#C0FF03',\n            photoTeamUrl: (row === null || row === void 0 ? void 0 : row.photoTeamUrl) || null\n          };\n        }\n      } catch {\n        // no-op\n      }\n    };\n    ws.onerror = e => console.error('[RaceLive] WS error', e);\n\n    // ===== Canvas draw loop (SOLO rendering) =====\n    const canvas = canvasRef.current;\n    if (!canvas) return () => ws.close();\n    const ctx = canvas.getContext('2d');\n    const dpr = window.devicePixelRatio || 1;\n    dprRef.current = dpr;\n    const ensureSize = () => {\n      const container = canvas.parentElement;\n      const w = container.clientWidth || 600;\n      const h = container.clientHeight || 520;\n      if (canvas.width !== Math.floor(w * dpr) || canvas.height !== Math.floor(h * dpr)) {\n        canvas.width = Math.floor(w * dpr);\n        canvas.height = Math.floor(h * dpr);\n        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n      }\n    };\n    const onResize = () => ensureSize();\n    ensureSize();\n    window.addEventListener('resize', onResize);\n    const wheel = e => {\n      e.preventDefault();\n      zoomRef.current = Math.max(0.5, Math.min(5, zoomRef.current * (e.deltaY > 0 ? 0.9 : 1.1)));\n    };\n    const mousedown = e => {\n      isDraggingRef.current = true;\n      lastMouseRef.current = {\n        x: e.clientX,\n        y: e.clientY\n      };\n      canvas.style.cursor = 'grabbing';\n    };\n    const mousemove = e => {\n      if (!isDraggingRef.current) return;\n      const dx = e.clientX - lastMouseRef.current.x;\n      const dy = e.clientY - lastMouseRef.current.y;\n      panRef.current.x += dx;\n      panRef.current.y += dy;\n      lastMouseRef.current = {\n        x: e.clientX,\n        y: e.clientY\n      };\n    };\n    const mouseup = () => {\n      isDraggingRef.current = false;\n      canvas.style.cursor = 'grab';\n    };\n    canvas.addEventListener('wheel', wheel, {\n      passive: false\n    });\n    canvas.addEventListener('mousedown', mousedown);\n    canvas.addEventListener('mousemove', mousemove);\n    canvas.addEventListener('mouseup', mouseup);\n    canvas.addEventListener('mouseleave', mouseup);\n    canvas.style.cursor = 'grab';\n\n    // Proiezione dal circuito passato nel config\n    const lats = ((circuitData === null || circuitData === void 0 ? void 0 : circuitData.sectors) || []).map(s => s.lat);\n    const lons = ((circuitData === null || circuitData === void 0 ? void 0 : circuitData.sectors) || []).map(s => s.lon);\n    const minLat = Math.min(...lats),\n      maxLat = Math.max(...lats);\n    const minLon = Math.min(...lons),\n      maxLon = Math.max(...lons);\n    const centerLat = isFinite(minLat) ? (minLat + maxLat) / 2 : 0;\n    const centerLon = isFinite(minLon) ? (minLon + maxLon) / 2 : 0;\n    const R = 6371000;\n    const centerLatRad = centerLat * Math.PI / 180;\n    const dxList = lons.map(l => (l - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad));\n    const dyList = lats.map(l => (l - centerLat) * Math.PI / 180 * R);\n    const maxDx = dxList.length ? Math.max(...dxList.map(Math.abs)) : 1;\n    const maxDy = dyList.length ? Math.max(...dyList.map(Math.abs)) : 1;\n    const padding = 40;\n    const project = (lat, lon) => {\n      const w = canvas.width / dprRef.current;\n      const h = canvas.height / dprRef.current;\n      const maxRange = Math.max(maxDx, maxDy) * 1.1;\n      const scale = Math.min(w - padding * 2, h - padding * 2) / (maxRange * 2) * zoomRef.current;\n      const dx = (lon - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad);\n      const dy = (lat - centerLat) * Math.PI / 180 * R;\n      const x = w / 2 + dx * scale + panRef.current.x;\n      const y = h / 2 - dy * scale + panRef.current.y;\n      return {\n        x,\n        y,\n        scale\n      };\n    };\n    const draw = () => {\n      var _circuitData$sectors;\n      ensureSize();\n      const w = canvas.width / dprRef.current;\n      const h = canvas.height / dprRef.current;\n      ctx.clearRect(0, 0, w, h);\n      ctx.fillStyle = '#0a0a0a';\n      ctx.fillRect(0, 0, w, h);\n\n      // Disegno pista (minimale, con larghezza da json)\n      if (circuitData !== null && circuitData !== void 0 && (_circuitData$sectors = circuitData.sectors) !== null && _circuitData$sectors !== void 0 && _circuitData$sectors.length) {\n        var _circuitData$params$w, _circuitData$params, _pts$;\n        const widthMeters = (_circuitData$params$w = (_circuitData$params = circuitData.params) === null || _circuitData$params === void 0 ? void 0 : _circuitData$params.widthMeters) !== null && _circuitData$params$w !== void 0 ? _circuitData$params$w : 6;\n        const pts = circuitData.sectors.map(s => project(s.lat, s.lon));\n        const scale = ((_pts$ = pts[0]) === null || _pts$ === void 0 ? void 0 : _pts$.scale) || 1;\n        const trackPx = Math.max(6, widthMeters * scale);\n\n        // bordo soft\n        ctx.strokeStyle = 'rgba(255,255,255,0.10)';\n        ctx.lineWidth = trackPx + 4;\n        ctx.lineCap = 'round';\n        ctx.lineJoin = 'round';\n        ctx.beginPath();\n        pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n        ctx.closePath();\n        ctx.stroke();\n\n        // asfalto\n        ctx.strokeStyle = 'rgba(80, 84, 90, 0.95)';\n        ctx.lineWidth = trackPx;\n        ctx.beginPath();\n        pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n        ctx.closePath();\n        ctx.stroke();\n\n        // linea di start\n        if (pts.length > 1) {\n          const s0 = pts[0],\n            s1 = pts[1];\n          const ang = Math.atan2(s1.y - s0.y, s1.x - s0.x);\n          ctx.save();\n          ctx.translate(s0.x, s0.y);\n          ctx.rotate(ang);\n          ctx.strokeStyle = '#ffffff';\n          ctx.lineWidth = Math.max(2, trackPx * 0.12);\n          ctx.beginPath();\n          ctx.moveTo(0, -trackPx * 0.5);\n          ctx.lineTo(0, trackPx * 0.5);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n\n      // Piloti (marker) – SOLO dai pacchetti GPS realtime\n      Object.values(driverPositionsRef.current).forEach(pos => {\n        const p = project(pos.lat, pos.lon);\n        if (!p) return;\n        const r = Math.max(5, 6 * (zoomRef.current * 0.9));\n        ctx.shadowColor = 'rgba(0,0,0,0.5)';\n        ctx.shadowBlur = 4;\n        ctx.fillStyle = pos.color || '#C0FF03';\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, r, 0, Math.PI * 2);\n        ctx.fill();\n        ctx.shadowBlur = 0;\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n        ctx.fillStyle = '#fff';\n        ctx.font = 'bold 10px Roboto, sans-serif';\n        ctx.textAlign = 'center';\n        ctx.fillText((pos.tag || 'PIL').slice(0, 4), p.x, p.y - (r + 8));\n      });\n      animFrameRef.current = requestAnimationFrame(draw);\n    };\n    draw();\n    return () => {\n      window.removeEventListener('resize', onResize);\n      canvas.removeEventListener('wheel', wheel);\n      canvas.removeEventListener('mousedown', mousedown);\n      canvas.removeEventListener('mousemove', mousemove);\n      canvas.removeEventListener('mouseup', mouseup);\n      canvas.removeEventListener('mouseleave', mouseup);\n      if (animFrameRef.current) cancelAnimationFrame(animFrameRef.current);\n      try {\n        ws.close();\n      } catch {}\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [circuitData /* non dipendere da summary per non resettare il loop */]);\n\n  /* ---------- Helpers UI ---------- */\n  const statusColors = useMemo(() => {\n    switch (raceStatus) {\n      case 'RED FLAG':\n        return {\n          chipBg: 'rgba(225,6,0,.15)',\n          chipBorder: '#e10600',\n          chipText: '#ffdede',\n          lbBorder: '#e10600'\n        };\n      case 'YELLOW FLAG':\n        return {\n          chipBg: 'rgba(241,196,15,.15)',\n          chipBorder: '#f1c40f',\n          chipText: '#fff3c4',\n          lbBorder: '#f1c40f'\n        };\n      case 'FINITA':\n        return {\n          chipBg: 'rgba(154,163,154,.15)',\n          chipBorder: '#9aa39a',\n          chipText: '#e0e0e0',\n          lbBorder: '#9aa39a'\n        };\n      case 'IN CORSO':\n      default:\n        return {\n          chipBg: 'rgba(21,193,48,.15)',\n          chipBorder: '#15c130',\n          chipText: '#e9ffe0',\n          lbBorder: null\n        };\n    }\n  }, [raceStatus]);\n\n  // Leaderboard dal server\n  const board = (summary === null || summary === void 0 ? void 0 : summary.leaderboard) || [];\n  const gapTextOf = (d, idx) => {\n    if (idx === 0) return 'LEADER';\n    // il server può mandare gap in secondi o già string formattata\n    if (typeof d.gap === 'string') return d.gap.startsWith('+') ? d.gap : `+${d.gap}`;\n    const v = Number(d.gap || 0).toFixed(2);\n    return `+${v}`;\n  };\n  const penaltySummary = row => {\n    const parts = [];\n    if (row !== null && row !== void 0 && row.penaltySeconds) parts.push(`+${row.penaltySeconds}s`);\n    if (row !== null && row !== void 0 && row.warnings) parts.push(`⚠️ x${row.warnings}`);\n    if (row !== null && row !== void 0 && row.dq) parts.push('DQ');\n    return parts.length ? parts.join('  ') : '—';\n  };\n\n  /* ---------- Render ---------- */\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"main small-top\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rs-live-topbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rs-live-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            \"aria-hidden\": true,\n            style: {\n              width: 10,\n              height: 10,\n              borderRadius: '50%',\n              background: '#ff4d4f',\n              boxShadow: '0 0 12px rgba(255,77,79,.8)',\n              opacity: blink ? 1 : .25,\n              transition: 'opacity .15s linear'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 13\n          }, this), \"LIVE\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [((_summary$totalLaps = summary === null || summary === void 0 ? void 0 : summary.totalLaps) !== null && _summary$totalLaps !== void 0 ? _summary$totalLaps : totalLaps) || 0, \" giri\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          style: {\n            background: statusColors.chipBg,\n            border: `1px solid ${statusColors.chipBorder}`,\n            color: statusColors.chipText,\n            fontWeight: 800\n          },\n          children: raceStatus\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rs-live-right\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: (circuitData === null || circuitData === void 0 ? void 0 : circuitData.name) || 'Circuito'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 11\n        }, this), (circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$stats = circuitData.stats) === null || _circuitData$stats === void 0 ? void 0 : _circuitData$stats.lengthMeters) && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [circuitData.stats.lengthMeters.toFixed(0), \" m\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 48\n        }, this), (circuitData === null || circuitData === void 0 ? void 0 : (_circuitData$params2 = circuitData.params) === null || _circuitData$params2 === void 0 ? void 0 : _circuitData$params2.widthMeters) && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"chip readonly\",\n          children: [circuitData.params.widthMeters, \" m larghezza\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 48\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rs-live-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"track-card\",\n        children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          className: \"track-canvas\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"leaderboard-card\",\n        style: {\n          borderColor: (_statusColors$lbBorde = statusColors.lbBorder) !== null && _statusColors$lbBorde !== void 0 ? _statusColors$lbBorde : 'var(--line)',\n          boxShadow: statusColors.lbBorder ? `0 8px 32px ${statusColors.lbBorder}33, inset 0 0 0 1px ${statusColors.lbBorder}55` : undefined\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-title\",\n            children: \"CLASSIFICA\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-sub\",\n            children: [board.length, \" piloti\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-list\",\n          children: board.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"no-drivers\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Nessun dato GPS ancora disponibile\\u2026\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"muted\",\n              children: \"Appena arrivano i pacchetti la classifica si popola\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 15\n          }, this) : board.map((d, idx) => {\n            var _ref, _summary$totalLaps2;\n            const fastest = (summary === null || summary === void 0 ? void 0 : summary.bestLapOverall) && d.bestLapTime && d.bestLapTime === summary.bestLapOverall;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `lb-row ${idx === 0 ? 'lb-leader' : ''}`,\n              title: d.fullName,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-pos\",\n                children: idx + 1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 326,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-team\",\n                children: d.photoTeamUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: `${API_BASE}${d.photoTeamUrl}`,\n                  alt: d.team,\n                  className: \"lb-team-logo\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 330,\n                  columnNumber: 25\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"lb-team-color\",\n                  style: {\n                    background: d.color || '#C0FF03'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 332,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 328,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-name\",\n                children: (d.tag || 'PIL').slice(0, 4)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-gap\",\n                children: gapTextOf(d, idx)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 338,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-icons\",\n                children: [fastest && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"lb-icon purple\",\n                  title: `Best lap ${formatLap(d.bestLapTime)}`,\n                  children: \"\\u23F1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 341,\n                  columnNumber: 35\n                }, this), (d.penaltySeconds > 0 || d.warnings > 0 || d.dq) && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"lb-icon\",\n                  title: penaltySummary(d),\n                  children: \"\\u26A0\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 343,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 340,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-lap\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"muted\",\n                  children: \"Lap\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 348,\n                  columnNumber: 23\n                }, this), \"\\xA0\", d.lapCount, \"/\", (_ref = (_summary$totalLaps2 = summary === null || summary === void 0 ? void 0 : summary.totalLaps) !== null && _summary$totalLaps2 !== void 0 ? _summary$totalLaps2 : totalLaps) !== null && _ref !== void 0 ? _ref : 0]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 347,\n                columnNumber: 21\n              }, this)]\n            }, d.mac, true, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 19\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"leaderboard-card\",\n      style: {\n        marginTop: 12,\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-header\",\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'baseline'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-title\",\n          children: \"CLASSIFICA DETTAGLIATA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-sub\",\n          children: [board.length, \" piloti \\u2022 tempi ultimo giro e miglior giro\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-list\",\n        children: board.map((d, idx) => {\n          var _ref2, _summary$totalLaps3;\n          const fastest = (summary === null || summary === void 0 ? void 0 : summary.bestLapOverall) && d.bestLapTime && d.bestLapTime === summary.bestLapOverall;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lb-row\",\n            style: {\n              gridTemplateColumns: '28px 28px 1fr 90px 110px 110px 140px 90px'\n            },\n            title: d.fullName,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-pos\",\n              children: idx + 1\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-team\",\n              children: d.photoTeamUrl ? /*#__PURE__*/_jsxDEV(\"img\", {\n                src: `${API_BASE}${d.photoTeamUrl}`,\n                alt: d.team,\n                className: \"lb-team-logo\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 379,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"lb-team-color\",\n                style: {\n                  background: d.color || '#C0FF03'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 381,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-name\",\n              children: (d.tag || 'PIL').slice(0, 4)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              style: {\n                textAlign: 'right'\n              },\n              children: gapTextOf(d, idx)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 387,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Ultimo giro\",\n              style: {\n                fontWeight: 700,\n                color: '#e9ffe0'\n              },\n              children: formatLap(d.lastLapTime)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 391,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Miglior giro\",\n              style: {\n                fontWeight: 700,\n                color: fastest ? '#b085ff' : '#e9ffe0'\n              },\n              children: [formatLap(d.bestLapTime), fastest && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"lb-icon purple\",\n                style: {\n                  marginLeft: 6\n                },\n                children: \"\\u23F1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 397,\n                columnNumber: 31\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-gap\",\n              title: \"Penalit\\xE0 assegnate\",\n              style: {\n                fontWeight: 800\n              },\n              children: penaltySummary(d)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"lb-lap\",\n              style: {\n                textAlign: 'right'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"muted\",\n                children: \"Lap\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 19\n              }, this), \"\\xA0\", d.lapCount, \"/\", (_ref2 = (_summary$totalLaps3 = summary === null || summary === void 0 ? void 0 : summary.totalLaps) !== null && _summary$totalLaps3 !== void 0 ? _summary$totalLaps3 : totalLaps) !== null && _ref2 !== void 0 ? _ref2 : 0]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 17\n            }, this)]\n          }, `wide-${d.mac}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 369,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"leaderboard-card\",\n      style: {\n        marginTop: 12,\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lb-header\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lb-title\",\n          children: \"COMANDI GARA\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"race-controls\",\n        style: {\n          justifyContent: 'space-between',\n          gap: 12,\n          flexWrap: 'wrap',\n          padding: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            flexWrap: 'wrap'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"muted\",\n            children: \"Stato:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 13\n          }, this), ['IN CORSO', 'FINITA', 'RED FLAG', 'YELLOW FLAG'].map(s => /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-ghost\",\n            onClick: async () => {\n              setRaceStatus(s);\n              try {\n                await fetch(`${API_BASE}/api/race/status`, {\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify({\n                    status: s\n                  })\n                });\n              } catch {}\n            },\n            style: {\n              borderColor: raceStatus === s ? 'rgba(192,255,3,0.6)' : 'var(--line)',\n              boxShadow: raceStatus === s ? '0 0 0 2px rgba(192,255,3,0.12) inset' : 'none',\n              fontWeight: 700\n            },\n            children: s\n          }, s, false, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            flexWrap: 'wrap',\n            marginTop: '15px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"muted\",\n            children: \"Sanzioni:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PenaltyControls, {\n            board: board\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            marginTop: '20px'\n          },\n          className: \"btn-danger\",\n          onClick: async () => {\n            try {\n              await fetch(`${API_BASE}/api/race/stop`, {\n                method: 'POST'\n              });\n            } catch {}\n            onStopRace();\n          },\n          children: \"Termina gara\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 455,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 420,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 255,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---- Subcomponent: controlli sanzioni (server-side) ---- */\n_s(RaceLive, \"B71qurltCf7vZcJkZoQSnGMR9ug=\");\n_c = RaceLive;\nfunction PenaltyControls({\n  board\n}) {\n  _s2();\n  const [mac, setMac] = useState('');\n  const [type, setType] = useState('+5s');\n  const apply = async () => {\n    if (!mac) return;\n    const row = board.find(r => r.mac === mac);\n    const payload = {\n      mac,\n      pilotId: (row === null || row === void 0 ? void 0 : row.pilotId) || null,\n      // mando anche pilotId se presente\n      type\n    };\n    try {\n      await fetch(`${API_BASE}/api/race/penalty`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      // il server invierà il nuovo summary via WS (1Hz)\n      setType('+5s');\n    } catch (e) {\n      console.error(e);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"select\", {\n      className: \"input\",\n      value: mac,\n      onChange: e => setMac(e.target.value),\n      style: {\n        width: 260\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"\",\n        children: \"-- Seleziona pilota --\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 9\n      }, this), board.map(d => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: d.mac,\n        children: [(d.tag || 'PIL').slice(0, 4), \" \\u2014 \", d.fullName || d.name || '']\n      }, d.mac, true, {\n        fileName: _jsxFileName,\n        lineNumber: 503,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 495,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      className: \"input\",\n      value: type,\n      onChange: e => setType(e.target.value),\n      style: {\n        width: 220\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"+5s\",\n        children: \"+5s\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"+10s\",\n        children: \"+10s\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"+15s\",\n        children: \"+15s\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 515,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"1mo avv. squalifica\",\n        children: \"1mo avv. squalifica\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: \"squalifica\",\n        children: \"squalifica\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 507,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-ghost\",\n      onClick: apply,\n      disabled: !mac,\n      style: {\n        fontWeight: 800\n      },\n      children: \"Applica\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 520,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s2(PenaltyControls, \"9+/gcBL7T/5JY7T3p7sKOCRnhjc=\");\n_c2 = PenaltyControls;\nvar _c, _c2;\n$RefreshReg$(_c, \"RaceLive\");\n$RefreshReg$(_c2, \"PenaltyControls\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE","process","env","REACT_APP_API_BASE","window","location","hostname","WS_URL","REACT_APP_WS_URL","formatLap","s","m","Math","floor","sec","toFixed","padStart","RaceLive","raceConfig","onStopRace","_s","_summary$totalLaps","_circuitData$stats","_circuitData$params2","_statusColors$lbBorde","circuitData","totalLaps","summary","setSummary","raceStatus","setRaceStatus","blink","setBlink","t","setInterval","b","clearInterval","canvasRef","animFrameRef","zoomRef","panRef","x","y","isDraggingRef","lastMouseRef","dprRef","driverPositionsRef","ws","WebSocket","onmessage","event","msg","JSON","parse","data","type","_msg$payload","payload","status","mac","lat","lon","String","lb","leaderboard","row","find","current","Number","tag","slice","color","photoTeamUrl","onerror","e","console","error","canvas","close","ctx","getContext","dpr","devicePixelRatio","ensureSize","container","parentElement","w","clientWidth","h","clientHeight","width","height","setTransform","onResize","addEventListener","wheel","preventDefault","max","min","deltaY","mousedown","clientX","clientY","style","cursor","mousemove","dx","dy","mouseup","passive","lats","sectors","map","lons","minLat","maxLat","minLon","maxLon","centerLat","isFinite","centerLon","R","centerLatRad","PI","dxList","l","cos","dyList","maxDx","length","abs","maxDy","padding","project","maxRange","scale","draw","_circuitData$sectors","clearRect","fillStyle","fillRect","_circuitData$params$w","_circuitData$params","_pts$","widthMeters","params","pts","trackPx","strokeStyle","lineWidth","lineCap","lineJoin","beginPath","forEach","p","i","lineTo","moveTo","closePath","stroke","s0","s1","ang","atan2","save","translate","rotate","restore","Object","values","pos","r","shadowColor","shadowBlur","arc","fill","font","textAlign","fillText","requestAnimationFrame","removeEventListener","cancelAnimationFrame","statusColors","chipBg","chipBorder","chipText","lbBorder","board","gapTextOf","d","idx","gap","startsWith","v","penaltySummary","parts","penaltySeconds","push","warnings","dq","join","className","children","display","alignItems","borderRadius","background","boxShadow","opacity","transition","fileName","_jsxFileName","lineNumber","columnNumber","border","fontWeight","name","stats","lengthMeters","ref","borderColor","undefined","_ref","_summary$totalLaps2","fastest","bestLapOverall","bestLapTime","title","fullName","src","alt","team","lapCount","marginTop","justifyContent","_ref2","_summary$totalLaps3","gridTemplateColumns","lastLapTime","marginLeft","flexWrap","onClick","fetch","method","headers","body","stringify","PenaltyControls","_c","_s2","setMac","setType","apply","pilotId","value","onChange","target","disabled","_c2","$RefreshReg$"],"sources":["/home/ubuntu/racesense/racesense-frontend/src/pages/RaceLive.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useMemo } from 'react';\nimport '../App.css';\n\nconst API_BASE = process.env.REACT_APP_API_BASE || `http://${window.location.hostname}:5000`;\nconst WS_URL = process.env.REACT_APP_WS_URL || `ws://${window.location.hostname}:5001`;\n\n/* ---------------- Utils ---------------- */\nconst formatLap = (s) => {\n  if (!s && s !== 0) return '—';\n  const m = Math.floor(s / 60);\n  const sec = (s % 60).toFixed(3);\n  return `${m}:${sec.padStart(6, '0')}`;\n};\n\n/* ---------------- Component ---------------- */\nexport default function RaceLive({ raceConfig, onStopRace }) {\n  const { circuitData, totalLaps } = raceConfig;\n\n  // Stato proveniente dal server\n  const [summary, setSummary] = useState(null);       // contiene leaderboard, bestLapOverall, status, ecc\n  const [raceStatus, setRaceStatus] = useState('IN CORSO');\n\n  // UI: blink puntino LIVE\n  const [blink, setBlink] = useState(true);\n  useEffect(() => {\n    const t = setInterval(() => setBlink(b => !b), 700);\n    return () => clearInterval(t);\n  }, []);\n\n  // Canvas & proiezione\n  const canvasRef = useRef(null);\n  const animFrameRef = useRef(null);\n  const zoomRef = useRef(1);\n  const panRef = useRef({ x: 0, y: 0 });\n  const isDraggingRef = useRef(false);\n  const lastMouseRef = useRef({ x: 0, y: 0 });\n  const dprRef = useRef(1);\n  // Posizioni piloti aggiornate in tempo reale dai pacchetti GPS\n  const driverPositionsRef = useRef({}); // { [mac]: {lat,lon,tag,color,photoTeamUrl} }\n\n  // ===== WebSocket: ricevo GPS (realtime) + SUMMARY (1Hz dal server) =====\n  useEffect(() => {\n    const ws = new WebSocket(WS_URL);\n\n    ws.onmessage = (event) => {\n      try {\n        const msg = JSON.parse(event.data);\n\n        // Aggiornamenti periodici della classifica/calcoli lato server\n        if (msg?.type === 'race') {\n          setSummary(msg.payload || null);\n          if (msg.payload?.status) setRaceStatus(msg.payload.status);\n          return;\n        }\n\n        // Pacchetti GPS (realtime). Compatibilità anche con payload \"piatto\" { mac, lat, lon, ... }\n        if (msg?.type === 'gps' || (msg?.mac && msg?.lat && msg?.lon)) {\n          const mac = String(msg.mac);\n          // prendo colore/tag dal summary corrente, se presente\n          const lb = (summary?.leaderboard || []);\n          const row = lb.find(x => x.mac === mac);\n          driverPositionsRef.current[mac] = {\n            lat: Number(msg.lat),\n            lon: Number(msg.lon),\n            tag: (row?.tag || 'PIL').slice(0, 4),\n            color: row?.color || '#C0FF03',\n            photoTeamUrl: row?.photoTeamUrl || null\n          };\n        }\n      } catch {\n        // no-op\n      }\n    };\n\n    ws.onerror = (e) => console.error('[RaceLive] WS error', e);\n\n    // ===== Canvas draw loop (SOLO rendering) =====\n    const canvas = canvasRef.current;\n    if (!canvas) return () => ws.close();\n    const ctx = canvas.getContext('2d');\n    const dpr = window.devicePixelRatio || 1;\n    dprRef.current = dpr;\n\n    const ensureSize = () => {\n      const container = canvas.parentElement;\n      const w = container.clientWidth || 600;\n      const h = container.clientHeight || 520;\n      if (canvas.width !== Math.floor(w * dpr) || canvas.height !== Math.floor(h * dpr)) {\n        canvas.width = Math.floor(w * dpr);\n        canvas.height = Math.floor(h * dpr);\n        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n      }\n    };\n\n    const onResize = () => ensureSize();\n    ensureSize();\n    window.addEventListener('resize', onResize);\n\n    const wheel = (e) => { e.preventDefault(); zoomRef.current = Math.max(0.5, Math.min(5, zoomRef.current * (e.deltaY > 0 ? 0.9 : 1.1))); };\n    const mousedown = (e) => { isDraggingRef.current = true; lastMouseRef.current = { x: e.clientX, y: e.clientY }; canvas.style.cursor = 'grabbing'; };\n    const mousemove = (e) => {\n      if (!isDraggingRef.current) return;\n      const dx = e.clientX - lastMouseRef.current.x;\n      const dy = e.clientY - lastMouseRef.current.y;\n      panRef.current.x += dx; panRef.current.y += dy;\n      lastMouseRef.current = { x: e.clientX, y: e.clientY };\n    };\n    const mouseup = () => { isDraggingRef.current = false; canvas.style.cursor = 'grab'; };\n\n    canvas.addEventListener('wheel', wheel, { passive: false });\n    canvas.addEventListener('mousedown', mousedown);\n    canvas.addEventListener('mousemove', mousemove);\n    canvas.addEventListener('mouseup', mouseup);\n    canvas.addEventListener('mouseleave', mouseup);\n    canvas.style.cursor = 'grab';\n\n    // Proiezione dal circuito passato nel config\n    const lats = (circuitData?.sectors || []).map(s => s.lat);\n    const lons = (circuitData?.sectors || []).map(s => s.lon);\n    const minLat = Math.min(...lats), maxLat = Math.max(...lats);\n    const minLon = Math.min(...lons), maxLon = Math.max(...lons);\n    const centerLat = isFinite(minLat) ? (minLat + maxLat) / 2 : 0;\n    const centerLon = isFinite(minLon) ? (minLon + maxLon) / 2 : 0;\n    const R = 6371000;\n    const centerLatRad = centerLat * Math.PI / 180;\n    const dxList = lons.map(l => (l - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad));\n    const dyList = lats.map(l => (l - centerLat) * Math.PI / 180 * R);\n    const maxDx = dxList.length ? Math.max(...dxList.map(Math.abs)) : 1;\n    const maxDy = dyList.length ? Math.max(...dyList.map(Math.abs)) : 1;\n    const padding = 40;\n\n    const project = (lat, lon) => {\n      const w = canvas.width / dprRef.current;\n      const h = canvas.height / dprRef.current;\n      const maxRange = Math.max(maxDx, maxDy) * 1.1;\n      const scale = Math.min(w - padding * 2, h - padding * 2) / (maxRange * 2) * zoomRef.current;\n      const dx = (lon - centerLon) * Math.PI / 180 * R * Math.cos(centerLatRad);\n      const dy = (lat - centerLat) * Math.PI / 180 * R;\n      const x = w / 2 + dx * scale + panRef.current.x;\n      const y = h / 2 - dy * scale + panRef.current.y;\n      return { x, y, scale };\n    };\n\n    const draw = () => {\n      ensureSize();\n\n      const w = canvas.width / dprRef.current;\n      const h = canvas.height / dprRef.current;\n      ctx.clearRect(0, 0, w, h);\n      ctx.fillStyle = '#0a0a0a';\n      ctx.fillRect(0, 0, w, h);\n\n      // Disegno pista (minimale, con larghezza da json)\n      if (circuitData?.sectors?.length) {\n        const widthMeters = circuitData.params?.widthMeters ?? 6;\n        const pts = circuitData.sectors.map(s => project(s.lat, s.lon));\n        const scale = pts[0]?.scale || 1;\n        const trackPx = Math.max(6, widthMeters * scale);\n\n        // bordo soft\n        ctx.strokeStyle = 'rgba(255,255,255,0.10)';\n        ctx.lineWidth = trackPx + 4;\n        ctx.lineCap = 'round';\n        ctx.lineJoin = 'round';\n        ctx.beginPath();\n        pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n        ctx.closePath(); ctx.stroke();\n\n        // asfalto\n        ctx.strokeStyle = 'rgba(80, 84, 90, 0.95)';\n        ctx.lineWidth = trackPx;\n        ctx.beginPath();\n        pts.forEach((p, i) => i ? ctx.lineTo(p.x, p.y) : ctx.moveTo(p.x, p.y));\n        ctx.closePath(); ctx.stroke();\n\n        // linea di start\n        if (pts.length > 1) {\n          const s0 = pts[0], s1 = pts[1];\n          const ang = Math.atan2(s1.y - s0.y, s1.x - s0.x);\n          ctx.save(); ctx.translate(s0.x, s0.y); ctx.rotate(ang);\n          ctx.strokeStyle = '#ffffff';\n          ctx.lineWidth = Math.max(2, trackPx * 0.12);\n          ctx.beginPath(); ctx.moveTo(0, -trackPx * 0.5); ctx.lineTo(0, trackPx * 0.5); ctx.stroke();\n          ctx.restore();\n        }\n      }\n\n      // Piloti (marker) – SOLO dai pacchetti GPS realtime\n      Object.values(driverPositionsRef.current).forEach(pos => {\n        const p = project(pos.lat, pos.lon);\n        if (!p) return;\n        const r = Math.max(5, 6 * (zoomRef.current * 0.9));\n        ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 4;\n        ctx.fillStyle = pos.color || '#C0FF03';\n        ctx.beginPath(); ctx.arc(p.x, p.y, r, 0, Math.PI * 2); ctx.fill();\n        ctx.shadowBlur = 0; ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();\n        ctx.fillStyle = '#fff'; ctx.font = 'bold 10px Roboto, sans-serif'; ctx.textAlign = 'center';\n        ctx.fillText((pos.tag || 'PIL').slice(0, 4), p.x, p.y - (r + 8));\n      });\n\n      animFrameRef.current = requestAnimationFrame(draw);\n    };\n\n    draw();\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n      canvas.removeEventListener('wheel', wheel);\n      canvas.removeEventListener('mousedown', mousedown);\n      canvas.removeEventListener('mousemove', mousemove);\n      canvas.removeEventListener('mouseup', mouseup);\n      canvas.removeEventListener('mouseleave', mouseup);\n      if (animFrameRef.current) cancelAnimationFrame(animFrameRef.current);\n      try { ws.close(); } catch { }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [circuitData, /* non dipendere da summary per non resettare il loop */]);\n\n  /* ---------- Helpers UI ---------- */\n  const statusColors = useMemo(() => {\n    switch (raceStatus) {\n      case 'RED FLAG':\n        return { chipBg: 'rgba(225,6,0,.15)', chipBorder: '#e10600', chipText: '#ffdede', lbBorder: '#e10600' };\n      case 'YELLOW FLAG':\n        return { chipBg: 'rgba(241,196,15,.15)', chipBorder: '#f1c40f', chipText: '#fff3c4', lbBorder: '#f1c40f' };\n      case 'FINITA':\n        return { chipBg: 'rgba(154,163,154,.15)', chipBorder: '#9aa39a', chipText: '#e0e0e0', lbBorder: '#9aa39a' };\n      case 'IN CORSO':\n      default:\n        return { chipBg: 'rgba(21,193,48,.15)', chipBorder: '#15c130', chipText: '#e9ffe0', lbBorder: null };\n    }\n  }, [raceStatus]);\n\n  // Leaderboard dal server\n  const board = summary?.leaderboard || [];\n\n  const gapTextOf = (d, idx) => {\n    if (idx === 0) return 'LEADER';\n    // il server può mandare gap in secondi o già string formattata\n    if (typeof d.gap === 'string') return d.gap.startsWith('+') ? d.gap : `+${d.gap}`;\n    const v = Number(d.gap || 0).toFixed(2);\n    return `+${v}`;\n  };\n\n  const penaltySummary = (row) => {\n    const parts = [];\n    if (row?.penaltySeconds) parts.push(`+${row.penaltySeconds}s`);\n    if (row?.warnings) parts.push(`⚠️ x${row.warnings}`);\n    if (row?.dq) parts.push('DQ');\n    return parts.length ? parts.join('  ') : '—';\n  };\n\n  /* ---------- Render ---------- */\n  return (\n    <div className=\"main small-top\">\n      {/* Top bar */}\n      <div className=\"rs-live-topbar\">\n        <div className=\"rs-live-left\">\n          <span className=\"chip readonly\" style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n            <span\n              aria-hidden\n              style={{\n                width: 10, height: 10, borderRadius: '50%',\n                background: '#ff4d4f', boxShadow: '0 0 12px rgba(255,77,79,.8)',\n                opacity: blink ? 1 : .25, transition: 'opacity .15s linear'\n              }}\n            />\n            LIVE\n          </span>\n          <span className=\"chip readonly\">{(summary?.totalLaps ?? totalLaps) || 0} giri</span>\n          <span\n            className=\"chip readonly\"\n            style={{\n              background: statusColors.chipBg,\n              border: `1px solid ${statusColors.chipBorder}`,\n              color: statusColors.chipText,\n              fontWeight: 800\n            }}\n          >\n            {raceStatus}\n          </span>\n        </div>\n        <div className=\"rs-live-right\">\n          <span className=\"chip readonly\">{circuitData?.name || 'Circuito'}</span>\n          {circuitData?.stats?.lengthMeters && <span className=\"chip readonly\">{circuitData.stats.lengthMeters.toFixed(0)} m</span>}\n          {circuitData?.params?.widthMeters && <span className=\"chip readonly\">{circuitData.params.widthMeters} m larghezza</span>}\n        </div>\n      </div>\n\n      {/* Griglia principale */}\n      <div className=\"rs-live-grid\">\n        <div className=\"track-card\">\n          <canvas ref={canvasRef} className=\"track-canvas\" />\n        </div>\n\n        {/* Classifica laterale: bordo dinamico per stato */}\n        <div\n          className=\"leaderboard-card\"\n          style={{\n            borderColor: statusColors.lbBorder ?? 'var(--line)',\n            boxShadow: statusColors.lbBorder\n              ? `0 8px 32px ${statusColors.lbBorder}33, inset 0 0 0 1px ${statusColors.lbBorder}55`\n              : undefined\n          }}\n        >\n          <div className=\"lb-header\">\n            <div className=\"lb-title\">CLASSIFICA</div>\n            <div className=\"lb-sub\">{board.length} piloti</div>\n          </div>\n\n          <div className=\"lb-list\">\n            {board.length === 0 ? (\n              <div className=\"no-drivers\">\n                <p>Nessun dato GPS ancora disponibile…</p>\n                <small className=\"muted\">Appena arrivano i pacchetti la classifica si popola</small>\n              </div>\n            ) : (\n              board.map((d, idx) => {\n                const fastest = summary?.bestLapOverall && d.bestLapTime && d.bestLapTime === summary.bestLapOverall;\n                return (\n                  <div\n                    key={d.mac}\n                    className={`lb-row ${idx === 0 ? 'lb-leader' : ''}`}\n                    title={d.fullName}\n                  >\n                    <div className=\"lb-pos\">{idx + 1}</div>\n\n                    <div className=\"lb-team\">\n                      {d.photoTeamUrl ? (\n                        <img src={`${API_BASE}${d.photoTeamUrl}`} alt={d.team} className=\"lb-team-logo\" />\n                      ) : (\n                        <div className=\"lb-team-color\" style={{ background: d.color || '#C0FF03' }} />\n                      )}\n                    </div>\n\n                    <div className=\"lb-name\">{(d.tag || 'PIL').slice(0, 4)}</div>\n\n                    <div className=\"lb-gap\">{gapTextOf(d, idx)}</div>\n\n                    <div className=\"lb-icons\">\n                      {fastest && <span className=\"lb-icon purple\" title={`Best lap ${formatLap(d.bestLapTime)}`}>⏱</span>}\n                      {(d.penaltySeconds > 0 || d.warnings > 0 || d.dq) && (\n                        <span className=\"lb-icon\" title={penaltySummary(d)}>⚠️</span>\n                      )}\n                    </div>\n\n                    <div className=\"lb-lap\">\n                      <span className=\"muted\">Lap</span>&nbsp;{d.lapCount}/{summary?.totalLaps ?? totalLaps ?? 0}\n                    </div>\n                  </div>\n                );\n              })\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* ======= CLASSIFICA FULL-WIDTH ======= */}\n      <div className=\"leaderboard-card\" style={{ marginTop: 12, width: '100%' }}>\n        <div className=\"lb-header\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'baseline' }}>\n          <div className=\"lb-title\">CLASSIFICA DETTAGLIATA</div>\n          <div className=\"lb-sub\">{board.length} piloti • tempi ultimo giro e miglior giro</div>\n        </div>\n\n        <div className=\"lb-list\">\n          {board.map((d, idx) => {\n            const fastest = summary?.bestLapOverall && d.bestLapTime && d.bestLapTime === summary.bestLapOverall;\n            return (\n              <div\n                key={`wide-${d.mac}`}\n                className=\"lb-row\"\n                style={{ gridTemplateColumns: '28px 28px 1fr 90px 110px 110px 140px 90px' }}\n                title={d.fullName}\n              >\n                <div className=\"lb-pos\">{idx + 1}</div>\n\n                <div className=\"lb-team\">\n                  {d.photoTeamUrl ? (\n                    <img src={`${API_BASE}${d.photoTeamUrl}`} alt={d.team} className=\"lb-team-logo\" />\n                  ) : (\n                    <div className=\"lb-team-color\" style={{ background: d.color || '#C0FF03' }} />\n                  )}\n                </div>\n\n                <div className=\"lb-name\">{(d.tag || 'PIL').slice(0, 4)}</div>\n\n                <div className=\"lb-gap\" style={{ textAlign: 'right' }}>\n                  {gapTextOf(d, idx)}\n                </div>\n\n                <div className=\"lb-gap\" title=\"Ultimo giro\" style={{ fontWeight: 700, color: '#e9ffe0' }}>\n                  {formatLap(d.lastLapTime)}\n                </div>\n\n                <div className=\"lb-gap\" title=\"Miglior giro\" style={{ fontWeight: 700, color: fastest ? '#b085ff' : '#e9ffe0' }}>\n                  {formatLap(d.bestLapTime)}\n                  {fastest && <span className=\"lb-icon purple\" style={{ marginLeft: 6 }}>⏱</span>}\n                </div>\n\n                {/* Penalità calcolate lato server */}\n                <div className=\"lb-gap\" title=\"Penalità assegnate\" style={{ fontWeight: 800 }}>\n                  {penaltySummary(d)}\n                </div>\n\n                <div className=\"lb-lap\" style={{ textAlign: 'right' }}>\n                  <span className=\"muted\">Lap</span>&nbsp;{d.lapCount}/{summary?.totalLaps ?? totalLaps ?? 0}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* ======= COMANDI GARA ======= */}\n      <div className=\"leaderboard-card\" style={{ marginTop: 12, width: '100%' }}>\n        <div className=\"lb-header\">\n          <div className=\"lb-title\">COMANDI GARA</div>\n        </div>\n\n        <div className=\"race-controls\" style={{ justifyContent: 'space-between', gap: 12, flexWrap: 'wrap', padding: '20px' }}>\n          {/* Stato gara (invia al server; il server lo ributta nel summary WS) */}\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}>\n            <span className=\"muted\">Stato:</span>\n            {['IN CORSO', 'FINITA', 'RED FLAG', 'YELLOW FLAG'].map(s => (\n              <button\n                key={s}\n                className=\"btn-ghost\"\n                onClick={async () => {\n                  setRaceStatus(s);\n                  try {\n                    await fetch(`${API_BASE}/api/race/status`, {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify({ status: s })\n                    });\n                  } catch { }\n                }}\n                style={{\n                  borderColor: raceStatus === s ? 'rgba(192,255,3,0.6)' : 'var(--line)',\n                  boxShadow: raceStatus === s ? '0 0 0 2px rgba(192,255,3,0.12) inset' : 'none',\n                  fontWeight: 700\n                }}\n              >\n                {s}\n              </button>\n            ))}\n          </div>\n\n          {/* Sanzioni: invia al server; il server ricalcola e invia nel prossimo summary */}\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap', marginTop: '15px' }}>\n            <span className=\"muted\">Sanzioni:</span>\n            <PenaltyControls board={board} />\n          </div>\n\n          <button style={{ marginTop: '20px' }} className=\"btn-danger\" onClick={async () => {\n            try { await fetch(`${API_BASE}/api/race/stop`, { method: 'POST' }); } catch { }\n            onStopRace();\n          }}>\n            Termina gara\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/* ---- Subcomponent: controlli sanzioni (server-side) ---- */\nfunction PenaltyControls({ board }) {\n  const [mac, setMac] = useState('');\n  const [type, setType] = useState('+5s');\n\n  const apply = async () => {\n    if (!mac) return;\n    const row = board.find(r => r.mac === mac);\n    const payload = {\n      mac,\n      pilotId: row?.pilotId || null, // mando anche pilotId se presente\n      type\n    };\n    try {\n      await fetch(`${API_BASE}/api/race/penalty`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      });\n      // il server invierà il nuovo summary via WS (1Hz)\n      setType('+5s');\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  return (\n    <>\n      <select\n        className=\"input\"\n        value={mac}\n        onChange={(e) => setMac(e.target.value)}\n        style={{ width: 260 }}\n      >\n        <option value=\"\">-- Seleziona pilota --</option>\n        {board.map(d => (\n          <option key={d.mac} value={d.mac}>{(d.tag || 'PIL').slice(0, 4)} — {d.fullName || d.name || ''}</option>\n        ))}\n      </select>\n\n      <select\n        className=\"input\"\n        value={type}\n        onChange={(e) => setType(e.target.value)}\n        style={{ width: 220 }}\n      >\n        <option value=\"+5s\">+5s</option>\n        <option value=\"+10s\">+10s</option>\n        <option value=\"+15s\">+15s</option>\n        <option value=\"1mo avv. squalifica\">1mo avv. squalifica</option>\n        <option value=\"squalifica\">squalifica</option>\n      </select>\n\n      <button className=\"btn-ghost\" onClick={apply} disabled={!mac} style={{ fontWeight: 800 }}>\n        Applica\n      </button>\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}